\chapter{Експерименти}
\section{Класифікація стадії осередків діабетичної ретинопатії}
\subsection{Опис наборів даних}
Використані в цьому експерименті зображень, були взяті з декількох наборів даних. Для претренування нейронних мереж було використано відкритий набір даних від Kaggle: “Diabetic Retinopathy Detection Challenge 2015” {dr2015}.

Цей набір даних є найбільшим із загальнодоступних. Він складається з 35126 фотографій очного дна для лівого та правого ока американських громадян, з розміченими стадіями діабетичної ретинопатії за стандартним протоколом:
\begin{itemize}
	\item Відсутність діабетичної ретинопатії (мітка 0)
	\item Легка діабетична ретинопатія (мітка 1)
	\item Помірна діабетична ретинопатія (мітка 2)
	\item Важка діабетична ретинопатія (мітка 3)
	\item Проліферативна діабетична ретинопатія (мітка 4)
\end{itemize}

Крім того, були використані менші набори даних: набір зображень індійської діабетичної ретинопатії (IDRiD) {idrid}, з якого використано 413 фотографій очного дна, та MESSIDOR (Методи оцінки методів сегментації та індексації в області офтальмології сітківки) {messidor}, з якого використано 1200 фотографій очного дна. Оскільки розмітка оригінального набору даних MESSIDOR відрізняється від інших наборів даних, ми використали версію, яку група офтальмологів {messidor\_relabeled} помаркувала відповідно до стандартного протоколу. 

Усі зазначені набори даних мають однаковий розподіл міток класів, що є фундаментальною властивістю для цієї задачі. 

Оцінка проводиться на наборі даних Kaggle APTOS2019 {aptos2019}, дослідники мають доступ лише до тренувальної та валідаційної частин. Повний набір даних складається з 18590 фотографій очного дна, які розділені на набори з 3662 тренувальних, 1928 валідаційних та 13000 тестових зображень, що були розділені організаторами змагань Kaggle.

\subsection{Детальний опис структури нейронної мережі}

\subsection{Детальний опис процедури навчання}
\subsubsection{Ініціалізація нейронної мережі}
Відпочатку, енкодер ініціалізується параметрами нейронної мережі, що була натренована на наборі даних ImageNet. Параметри декодерів ініціалізуються випадково (ініціалізація Хе). 

\subsubsection{Трансферне навчання}
Використання трансферного навчання можливо, оскільки природні особливості діабетичної ретинопатії узгоджуються між різними людьми і не залежать від набору даних. Крім того, різні набори даних збираються на різному обладнанні. Включення цих знань у модель підвищує її здатність до узагальнення та підвищує важливість природних ознак за рахунок зменшення чутливості до особливостей обладнання.

Для попереднього навчання, ініціалізована нейронна мережа навчається на протязі 20 епох на наборі даних DRDC2015 за допомогою стохастичного градієнтного спуску. Основна мета попереднього навчання - створити ініціалізацію параметрів на розподілі даних, що є близьким до цільового. Після попереднього навчання, параметри нейронної мережі використовуються як ініціалізація для основного навчання.

Під час попереднього навчання, кожен декодер мінімізує свою функцію втрат: перехресну ентропію для класифікаційного декодера, бінарну перехресну ентропію для декодера порядкової регресії та середню абсолютну похибку для декодера регресії.

Основне тренування проводиться на наборах даних APTOS2019, IDRID та MESSIDOR разом. Починаючи з ваг, отриманих на етапі попереднього тренування, виконується 5-кратна перехресна перевірка та оцінка моделі на відкладеному наборі даних. На цьому етапі функції втрат для декодерів змінено: Focal loss {focalloss} для класифікаційного декодера, бінарна Focal loss {focalloss}  для декодера порядкової регресії та середньоквадратична помилка для декодера регресії.

Зміна функцій втрат на даному етапі пов’язана з необхідністю знизити значення втрат для зразків, що вже коректно класифіковані, щоб зменшити вплив ознак, що не відносяться до захворювання.

Для кожної з підвиборок було натреновано одну модель, протягом 75 епох, використовуючи алгоритм оптимізації Rectified Adam, {radam}, зі зміною темпу навчання за косинусним законом. Щоб зберегти параметри енкодера, поки декодери перебувають у випадковому стані, оновлення параметрів енкодера не відбувається на протязі перших п’яти епох навчання.

\subsubsection{Комбінування результатів декількох задач}
На етапі після основного навчання, для кожної з моделей, навчається модель лінійної регресії з виходів декодерів в єдине значення.

Лінійна регресія навчається після основного навчання, оскільки в іншому випадку, сходиться до неоптимальних локальних мінімумів з вагами двох декодерів, близьких до нуля. Ці нульові ваги запобігають оновленню відповідних ваг декодерів і, відповідно, запобігають навчанню.
Початкові ваги для кожного з виходів декодерів були встановлені рівними 1/3, а потім тренувались протягом п’яти епох, щоб мінімізувати середньоквадратичну функцію помилки.

\subsubsection{Результати експерименту}

\section{Класифікація раку шкіри та сегментація родимок}
\subsection{Опис набору даних SIIM-ISIC Melanoma Classification}
Дані зображень, використані в цьому дослідженні, були взяті з декількох наборів даних з однаковою структурою: SIIM\&ISIC з 2017, 2018, 2019 та 2020 років. Ці набори даних були створені Міжнародною співпрацею з обробки зображень шкіри (англ. International Skin Imaging Collaboration - ISIC), а зображення отримані з наступних джерел:
\begin{itemize}
	\item лікарня Клінік де Барселона
	\item Віденський медичний університет
	\item Центр раку Меморіал Слоун Кеттерінг
	\item Австралійський інститут меланоми
	\item Квінслендський університет 
	\item Афінська медична школа
\end{itemize}

Загалом, ці набори даних складаються із приблизно 50000 
RGB-зображень, з яких близько 3000 мають зображення злоякісних уражень. Набір даних містить 434 повторюваних зображення. Окрім даних про зображення, були надані метадані про пацієнтів. Один пацієнт має декілька зображень різних родинок.

Зображення та метадані надані у форматі DICOM, який є загальновживаним форматом даних медичних зображень. Крім того, набір даних доступний у форматі JPEG із розмірами зображень, змінених до 1024x1024. Метадані також надаються за межами формату DICOM, у файлах CSV [12].

Метадані містять наступну інформацію:
\begin{itemize}
	\item image\_name - унікальний ідентифікатор, вказує на ім'я файлу відповідного зображення DICOM;
	\item patient\_id - унікальний ідентифікатор пацієнта;
	\item sex - стать пацієнта;
	\item age\_approx - приблизний вік пацієнта на момент фотографії (ціле число);
	\item anatom\_site\_general\_challenge - розташування родинки на тілі;
	\item diagnosis - детальна інформація про діагностику (рядок);
	\item benign\_malignant - показник злоякісності зображеного ураження (cnhjrf, одна з "benign" і "malignant");
	\item target - бінарізована версія цільової змінної.
\end{itemize}
Значення для anatom\_site\_general\_challenge та diagnosis беруться із заздалегідь 
визначеного кінцевого набору.

Метадані доступні для кожного пацієнта, тому різні зображення можуть мати однаковий набір функцій рівня пацієнта. Ми використовуємо всі доступні метадані, крім ідентифікатора пацієнта та діагностики, оскільки вони доступні лише в навчальних наборах даних.

Набір даних має дисбаланс високого класу. Розподіл діагнозів показано на рис. 1. Для значень unknown в полі diagnosis, автори набору даних гарантують, що новоутворення не є злоякісним [13].

Через те, що зображення в наборі даних з різних джерел та мають різні стандарти візуалізації вони мають структурований шум у вигляді лінійних смуг, областей, позначених ручкою, центруючих ліній тощо. Залежно від місця новоутворення та статі, також спостерігається волосся. Всі ці додаткові ознаки можуть значно вплинути на тренувальний процес і можуть призвести до перенавчання.

\subsection{Детальний опис структури нейронної мережі}

\subsection{Детальний опис процедури навчання}
В даному експерименті використано одноступеневий навчальний процес, який включає одночасно трансферне навчання та багатозадачне навчання.

Навчання проводиться у 3-кратній схемі перехресної перевірки. Енкодер відпочатку ініціалізується за допомогою вагів, отриманих за допомогою алгоритму [25]. У наших експериментах ми спостерігали, що така ініціалізація призводить до стабільно кращих результатів, ніж ініціалізація Imagenet.

\subsection{Результати експерименту}

\section{Класифікація та сегментація формацій хмар}
\subsection{Опис набору даних Understanding Clouds from Satellite Images}
Набір даних Understanding Clouds from Satellite Images (UCSID) складається з 10000 RGB зображень, зроблених з двох супутників TERRA та AQUA, що знаходяться на полярній орбіті [6]. Кожен з цих супутників проходить над певну областю один раз на день. Через обмежене поле зору камер, встановлених на цих супутниках, кожне зображення зшито з двох супутників, що знаходяться над однією й тою самою областю одночано, але на різних орбітах. Решта зображення, для якої не було знято даних під час прольоту супутників (між орбітами) заповнена чорним кольором. Оскільки зображення підлягають компресії, є артефакти стиснення, та чорний колір має деякі незначні аномалії.
 
На знімках є регіони, які містять певні хмарні утворення, та помічені дослідниками відповідно: Риба, Квітка, Гравій, Цукор (англ. Fish, Flower, Gravel, Sugar). Кожне зображення має принаймні одне хмарне утворення і може містити до всіх чотирьох одночасно.

Розмітка для цих регіонів була створена під час краудсорсингу в Інституті метеорології імені Макса Планка в Гамбурзі, Німеччина, та Laboratoire de m?t?orologie Dynamique у Парижі, Франція. Команда з 68 вчених виявила ділянки з хмарами на кожному зображенні, і кожне зображення було розмічене, в середньому, трьома різними вченими. Кожен вчений мав виділити хмари за допомогою прямокутних областей на власний розсуд. Основна розмітка була створена об’єднанням областей, що були розічені всіма вченими для цього зображення, після видалення чорної смуги з цих областей [7].

Через те, як був зібраний UCSID, він має значну кількість пікселів шуму масках для хмар. Оскільки маски складаються з прямокутників, які повністю перекривають хмару, існує багато пікселів, які позначені як хмари, але, насправді, відповідають фону. Також, не всі хмари позначені масками. Через об'єднання масок від різних анотаторів, класи можуть суттєво перекриватися, включаючи випадки, коли всі чотири класи присвоюються одним і тим самим пікселям.

Усі зображення мають вихідну роздільну здатність 2100x1400 пікселів. Більшість зображень містять більше ніж один клас хмар. Немає зображень без хмар. Розподіл класів хмар на зображеннях показано на рисунку.

Різні типи хмар зазвичай зустрічаються разом, розподіл комбінацій різних типів хмар зазначено на рисунку.
UCSID розділено на 5546 тренувальних, та 3698 валідаційних зображень. Крім того, немає доступу до міток валідаційного набору даних. Значення метрики можливо отримати через систему валідації.

До розподілу міток класів в наборі даних не було виконано змін (недодискретизація, передискретизація тощо).

\subsection{Детальний опис структури нейронної мережі}
\subsection{Результати експерименту}


